# Инструкция по тестированию поглощения элементов

## Что было реализовано

1. **Модель поглощения элементов** - элементы поглощаются растением с разной скоростью (период полураспада)
2. **История внесений** - каждое внесение при поливе сохраняется в `soilNutrients.additions`
3. **Автоматический пересчет** - текущее состояние почвы пересчитывается с учетом времени
4. **Отображение в статистике** - в "Статистике по элементам" показывается текущее состояние, а не сумма всех внесений

## Сценарии для тестирования

### 1. Массовый полив с удобрениями

1. Создайте раствор для полива с удобрениями (раздел "Массовый полив")
2. Создайте замес раствора
3. Примените полив к одному или нескольким перцам
4. Проверьте:
   - В карточке перца открыть "Графики и статистика"
   - В разделе "Статистика по элементам" должны отображаться элементы из раствора
   - Значения должны быть в граммах (не в процентах)

### 2. Проверка поглощения элементов

1. Примените полив с удобрениями к перцу
2. Запомните значения элементов в статистике
3. Подождите некоторое время (или измените системное время для теста)
4. Обновите страницу и проверьте:
   - Значения элементов должны уменьшиться (с учетом времени)
   - Макроэлементы (N, P, K) поглощаются быстрее
   - Микроэлементы (Fe, Mn, Zn) поглощаются медленнее

### 3. Множественные поливы

1. Примените несколько поливов с разными растворами к одному перцу
2. Проверьте:
   - В статистике должны суммироваться остатки от всех поливов
   - Каждый полив учитывается с учетом времени его внесения

### 4. Обратная совместимость

1. Откройте перец, у которого нет `soilNutrients` (старые данные)
2. Проверьте:
   - Статистика должна работать (суммирование из `fertilizingHistory`)
   - После первого полива через массовый полив должна появиться новая структура

## Что проверить в консоли браузера

1. Откройте DevTools → Console
2. При применении полива не должно быть ошибок
3. Проверьте данные перца в Firestore:
   - Должно быть поле `soilNutrients`
   - В `soilNutrients.additions` должны быть записи о поливах
   - `soilNutrients.current` должен содержать текущие значения элементов

## Известные ограничения

- **Ручное добавление удобрений** (через "Быстрые действия" или "История") пока не обновляет `soilNutrients.additions` - это работает только через массовый полив
- **Миграция старых данных** не выполняется автоматически - новые данные будут работать с новой системой

## Скорости поглощения (для справки)

- **N (Азот)**: 7 дней (168 часов)
- **P (Фосфор)**: 14 дней (336 часов)
- **K (Калий)**: 10 дней (240 часов)
- **Ca (Кальций)**: 30 дней (720 часов)
- **Fe (Железо)**: 20 дней (480 часов)
- **Mn (Марганец)**: 15 дней (360 часов)

Полный список в `src/utils/nutrient-absorption.ts`


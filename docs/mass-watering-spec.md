## Mass Watering Feature Plan

### Goals

- Позволить пользователю готовить раствор (вода + удобрения) и фиксировать массовый полив выбранных растений.
- Учесть расход питательных элементов, сохраняя историю поливов и обновляя состояние грунта.
- Предоставить рекомендации по частоте полива и предупреждения при передозировке/дефиците.

### Основные сущности

- **SolutionRecipe** — описание раствора:
  - `id`, `userId`, `name`
  - `waterVolumeMl`, `validForHours`
  - массив `ingredients` (`fertilizerId`, `displayName`, `amountGram`/`milliliter`, `notes`)
  - `createdAt`, `updatedAt`
- **WateringBatch** — конкретный замес раствора:
  - ссылки на рецепт или встроенное описание ингредиентов
  - `preparedAt`, `expiresAt`, `totalVolumeMl`, `remainingVolumeMl`
  - `targetPlants` (список `pepperId`/`seedlingSlot`)
  - `status` (`draft`, `ready`, `applied`, `discarded`)
- **WateringEvent** — запись об использовании раствора:
  - `batchId`, `appliedAt`, `appliedVolumeMl`
  - `targets` (список с фактическим объёмом на растение)
  - `notes`, `createdBy`
- **SoilNutrientState** (в pepper/slot):
  - `N`, `P`, `K`, `Ca`, `Mg`, `S`, `Fe`, `B`, `Mn`, `Zn`, `Cu`, `Mo`
  - `lastWateredAt`, `lastFertilizedAt`

### Firestore структура

- `/solutionRecipes/{recipeId}`
- `/wateringBatches/{batchId}`
  - подколлекция `/events/{eventId}` или отдельная коллекция `/wateringEvents`
- Расширения документов `peppers` и `seedlingTrays`:
  - `soilNutrients` объект с текущими уровнями и диапазонами
  - `wateringSchedule` (`minIntervalHours`, `maxIntervalHours`)

### Бизнес-правила

- Пользователь может создать раствор без сохранения рецепта (одноразовый batch).
- При применении полива:
  1. Проверить, что batch не просрочен и хватает остатка объёма.
  2. Для каждого растения записать `WateringEvent`.
  3. Рассчитать изменение `soilNutrients`:
     - `newValue = current + provided - consumption`.
     - `consumption` для выращивания задаём по умолчанию (константа) или настраиваем на уровне сорта.
  4. Обновить `lastWateredAt` и, если есть удобрения, `lastFertilizedAt`.
- Предупреждения:
  - если интервал с предыдущего полива < `minIntervalHours` → показать варнинг;
  - если > `maxIntervalHours` → выделить красным и рекомендовать полив;
  - если уровень элементов выходит за `minAvailable`/`maxAvailable` (по моделям сортов/пользовательским настройкам).

### UX-потоки

1. **Создание раствора**:
   - диалог/страница: выбор рецепта или создание нового, указание объёма воды, добавление удобрений.
   - показывает итоговую концентрацию, подсказки по растворимости.
2. **Выбор растений**:
   - режим мультивыбора в списке перцев или кассете.
   - отображает потребность каждого растения (объём, дата последнего полива).
3. **Применение batch**:
   - распределение объёма: равномерно/вручную.
   - фиксация результатов: журнал, обновление грунта, напоминания.
4. **История и аналитика**:
   - табы в карточке перца и кассеты: график поливов, уровни элементов, рекомендации.

### Следующие шаги реализации

1. Уточнить модель питательных элементов (дефолтные нормы, единицы измерения).
2. Подготовить интерфейсы TypeScript и обновить `models.ts`.
3. Реализовать Pinia-store и Firestore доступ для recipes/batches/events.
4. Добавить UI (диалог/страница массового полива).
5. Обновить карточки перцев/кассет для отображения новых данных.

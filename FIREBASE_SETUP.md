# Настройка Firebase Storage для CapsicumKeeper

## 1. Включение Firebase Storage

1. Перейдите в [Firebase Console](https://console.firebase.google.com/)
2. Выберите ваш проект
3. В левом меню найдите "Storage" и нажмите "Get started"
4. Выберите правила безопасности (рекомендуется "Start in test mode" для разработки)
5. Выберите регион для хранения данных

## 2. Настройка правил безопасности

1. В консоли Firebase перейдите в Storage → Rules
2. Замените содержимое на правила из файла `storage.rules`:

```javascript
rules_version = '2';
service firebase.storage {
  match /b/{bucket}/o {
    // Разрешаем загрузку изображений только авторизованным пользователям
    match /pepper-photos/{allPaths=**} {
      allow read: if true; // Все могут просматривать фото
      allow write: if request.auth != null
                   && request.resource.size < 5 * 1024 * 1024 // Максимум 5MB
                   && request.resource.contentType.matches('image/.*'); // Только изображения
    }

    // Запрещаем доступ ко всем остальным файлам
    match /{allPaths=**} {
      allow read, write: if false;
    }
  }
}
```

3. Нажмите "Publish"

## 3. Настройка CORS (если необходимо)

Если возникают проблемы с CORS, добавьте в Firebase Storage следующие настройки:

1. Установите Firebase CLI: `npm install -g firebase-tools`
2. Войдите в Firebase: `firebase login`
3. Инициализируйте проект: `firebase init storage`
4. Создайте файл `cors.json`:

```json
[
  {
    "origin": ["*"],
    "method": ["GET", "POST", "PUT", "DELETE"],
    "maxAgeSeconds": 3600
  }
]
```

5. Примените настройки: `gsutil cors set cors.json gs://YOUR-BUCKET-NAME`

## 4. Проверка работы

После настройки:

1. Запустите приложение: `npm run dev`
2. Попробуйте добавить новый перец с загрузкой изображения
3. Проверьте, что изображение загружается в Firebase Storage
4. Убедитесь, что изображение отображается в приложении

## 5. Безопасность

- Правила безопасности разрешают загрузку только изображений размером до 5MB
- Только авторизованные пользователи могут загружать файлы
- Все файлы хранятся в папке `pepper-photos/`
- Старые изображения автоматически удаляются при замене

## 6. Устранение проблем

### Ошибка "Permission denied"

- Проверьте, что пользователь авторизован
- Убедитесь, что правила безопасности опубликованы
- Проверьте размер файла (должен быть меньше 5MB)

### Ошибка "Network error"

- Проверьте подключение к интернету
- Убедитесь, что Firebase Storage включен в проекте
- Проверьте настройки CORS

### Изображение не отображается

- Проверьте URL изображения в консоли браузера
- Убедитесь, что правила чтения разрешают доступ
- Проверьте, что файл успешно загружен в Storage
